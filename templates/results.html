{% extends "base.html" %}

{% block title %}Research Results{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<style>
  .results-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .results-header {
    margin-bottom: 2rem;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 1.5rem;
  }
  
  .results-meta {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: #666;
  }
  
  .section {
    margin-bottom: 2rem;
  }
  
  .section-title {
    font-size: 1.5rem;
    color: #4a4a9c;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
  }
  
  .source {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background-color: #f9f9f9;
    border-radius: 4px;
  }
  
  .source-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }
  
  .source-title {
    font-weight: 600;
    color: #333;
  }
  
  .source-url {
    font-size: 0.85rem;
    word-break: break-all;
    color: #4285f4;
  }
  
  .source-meta {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 0.5rem;
  }
  
  .source-content {
    border-left: 3px solid #ddd;
    padding-left: 1rem;
    margin-top: 0.5rem;
  }
  
  .source-credibility {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.8rem;
    margin-right: 0.5rem;
  }
  
  .credibility-high {
    background-color: #d4edda;
    color: #155724;
  }
  
  .credibility-medium {
    background-color: #fff3cd;
    color: #856404;
  }
  
  .credibility-low {
    background-color: #f8d7da;
    color: #721c24;
  }
  
  .credibility-unknown {
    background-color: #e2e3e5;
    color: #383d41;
  }
  
  .statistics {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  
  .statistic {
    padding: 1rem;
    background-color: #f5f7ff;
    border-radius: 4px;
    text-align: center;
  }
  
  .statistic-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: #4a4a9c;
    margin-bottom: 0.5rem;
  }
  
  .statistic-label {
    font-size: 0.9rem;
    color: #666;
  }
  
  .information-item {
    margin-bottom: 1rem;
    padding: 1rem;
    background-color: #f9f9f9;
    border-radius: 4px;
  }
  
  .information-text {
    margin-bottom: 0.5rem;
  }
  
  .relevance-score {
    font-size: 0.85rem;
    color: #666;
  }
  
  .action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }
  
  .action-button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    background-color: #4a4a9c;
    color: white;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }
  
  .action-button.secondary {
    background-color: #6c757d;
  }
</style>
{% endblock %}

{% block content %}
<section class="results-container">
  <div class="results-header">
    <h2>Research Report: {{ job.topic.title }}</h2>
    <div class="results-meta">
      <span>Completed on: {{ job.completion_time|datetime }}</span>
      <span>Format: {{ job.parameters.format|title }}</span>
      <span>Depth: {{ job.parameters.depth|title }}</span>
    </div>
  </div>
  
  <div class="section">
    <h3 class="section-title">Executive Summary</h3>
    <p>This report presents findings on "{{ job.topic.title }}" based on analysis of multiple sources. The research examines key aspects and provides a comprehensive overview of the topic.</p>
  </div>
  
  <div class="section">
    <h3 class="section-title">Research Statistics</h3>
    <div class="statistics">
      <div class="statistic">
        <div class="statistic-value">{{ results.stats.search_results }}</div>
        <div class="statistic-label">Search Results</div>
      </div>
      <div class="statistic">
        <div class="statistic-value">{{ results.stats.pages_retrieved }}</div>
        <div class="statistic-label">Pages Retrieved</div>
      </div>
      <div class="statistic">
        <div class="statistic-value">{{ results.stats.information_items_extracted }}</div>
        <div class="statistic-label">Information Items</div>
      </div>
      <div class="statistic">
        <div class="statistic-value">{{ results.stats.queries_generated }}</div>
        <div class="statistic-label">Queries Generated</div>
      </div>
    </div>
  </div>
  
  <div class="section">
    <h3 class="section-title">Key Findings</h3>
    {% for source in results.results.sources %}
      {% for info in source.information %}
        <div class="information-item">
          <div class="information-text">{{ info.text }}</div>
          <div class="relevance-score">Relevance: {{ (info.relevance_score * 100)|int }}%</div>
        </div>
      {% endfor %}
    {% endfor %}
  </div>
  
  <div class="section">
    <h3 class="section-title">Sources</h3>
    {% for source in results.results.sources %}
      <div class="source">
        <div class="source-header">
          <div class="source-title">{{ source.title }}</div>
          <div>
            {% set credibility = source.evaluation.credibility %}
            <span class="source-credibility credibility-{{ credibility }}">
              {{ credibility|title }} Credibility
            </span>
          </div>
        </div>
        <div class="source-url">
          <a href="{{ source.url }}" target="_blank">{{ source.url }}</a>
        </div>
        <div class="source-meta">
          Relevance Score: {{ (source.evaluation.relevance_score * 100)|int }}%
        </div>
      </div>
    {% endfor %}
  </div>
  
  <div class="action-buttons">
    <a href="{{ url_for('new_research_request') }}" class="action-button">New Research</a>
    <a href="{{ url_for('completed_reports') }}" class="action-button secondary">View All Reports</a>
  </div>
</section>
{% endblock %}
